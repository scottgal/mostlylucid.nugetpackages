{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning",
      "Mostlylucid.BotDetection": "Debug",
      "Mostlylucid.BotDetection.Services.BotListUpdateService": "Information"
    }
  },
  "AllowedHosts": "*",

  "MockLlmApi": {
    "BaseUrl": "http://localhost:11434/v1/",
    "ModelName": "gemma3:4b",
    "Temperature": 0.7
  },

  "BotDetection": {
    "BotThreshold": 0.7,
    "EnableTestMode": true,
    "ExcludedPaths": ["/health", "/metrics", "/api/mock"],

    "TestModeSimulations": {
      "human": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
      "googlebot": "Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)",
      "bingbot": "Mozilla/5.0 (compatible; bingbot/2.0; +http://www.bing.com/bingbot.htm)",
      "scrapy": "Scrapy/2.11 (+https://scrapy.org)",
      "curl": "curl/8.4.0",
      "puppeteer": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/120.0.0.0 Safari/537.36",
      "malicious": "sqlmap/1.7 (http://sqlmap.org)",
      "gptbot": "Mozilla/5.0 AppleWebKit/537.36 (KHTML, like Gecko; compatible; GPTBot/1.0; +https://openai.com/gptbot)",
      "claudebot": "ClaudeBot/1.0; +https://anthropic.com",
      "twitterbot": "Twitterbot/1.0",
      "facebookbot": "facebookexternalhit/1.1 (+http://www.facebook.com/externalhit_uatext.php)",
      "uptimerobot": "UptimeRobot/2.0; +http://www.uptimerobot.com/",
      "nikto": "Mozilla/5.00 (Nikto/2.1.6) (Evasions:None) (Test:Port Check)",
      "nessus": "Nessus SOAP",
      "nmap": "Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)",
      "burpsuite": "Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 Burp/2023.10",
      "acunetix": "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US) Acunetix Web Vulnerability Scanner",
      "honeypot-harvester": "<test-honeypot:harvester>",
      "honeypot-spammer": "<test-honeypot:spammer>",
      "honeypot-suspicious": "<test-honeypot:suspicious>"
    },

    "PathPolicies": {
      "/bot-detection/*": "full-demo",
      "/bot-test": "full-demo",
      "/api/*": "full-demo",
      "/*": "full-demo"
    },

    "_policiesDocumentation": {
      "_comment": "POLICY CONFIGURATION GUIDE",
      "_fastPath": "Static detectors that run sync: UserAgent, Header, Ip, Behavioral, ClientSide, Inconsistency, VersionAge",
      "_aiPath": "AI detectors for sync decisions: Heuristic (fast ~1ms), Llm (slow ~500ms+). Add any registered AI detector.",
      "_learning": "When EscalateToAi=false, uncertain requests are queued for async learning with full AI pipeline.",
      "_example_noAi": "FastPath=[...], AiPath=[], EscalateToAi=false -> static only, async learning",
      "_example_heuristic": "FastPath=[...], AiPath=['Heuristic'], EscalateToAi=true -> static + Heuristic sync",
      "_example_full": "FastPath=[], AiPath=[], BypassTriggerConditions=true -> run ALL registered detectors"
    },
    "Policies": {
      "default": {
        "Description": "RECOMMENDED - All detectors + Heuristic in FastPath, LLMâ†’HeuristicLate in AiPath",
        "FastPath": ["FastPathReputation", "HoneypotLink", "UserAgent", "Header", "Ip", "SecurityTool", "ProjectHoneypot", "CacheBehavior", "Behavioral", "AdvancedBehavioral", "ClientSide", "Inconsistency", "VersionAge", "ReputationBias", "Heuristic"],
        "SlowPath": [],
        "AiPath": ["Llm", "HeuristicLate"],
        "UseFastPath": true,
        "ForceSlowPath": false,
        "EscalateToAi": true,
        "AiEscalationThreshold": 0.0,
        "EarlyExitThreshold": 0.85,
        "ImmediateBlockThreshold": 0.95,
        "Tags": ["production", "all-detectors", "heuristic", "llm"],
        "Transitions": [
          { "WhenRiskExceeds": 0.5, "WhenRiskBelow": 0.95, "ActionPolicyName": "holodeck", "Description": "Medium-high risk - redirect to holodeck for study" },
          { "WhenRiskExceeds": 0.95, "ActionPolicyName": "block", "Description": "Verified bad - block" }
        ]
      },
      "fastpath": {
        "Description": "FAST - All detectors + Heuristic, no LLM, escalates to default when uncertain",
        "FastPath": ["FastPathReputation", "UserAgent", "Header", "Ip", "SecurityTool", "ProjectHoneypot", "CacheBehavior", "Behavioral", "AdvancedBehavioral", "ClientSide", "Inconsistency", "VersionAge", "ReputationBias", "Heuristic"],
        "SlowPath": [],
        "AiPath": [],
        "UseFastPath": true,
        "ForceSlowPath": false,
        "EscalateToAi": false,
        "AiEscalationThreshold": 0.0,
        "EarlyExitThreshold": 0.15,
        "ImmediateBlockThreshold": 0.90,
        "Tags": ["production", "all-detectors", "heuristic-only"],
        "_weightsNote": "ClientSide weight lowered for demo - real browser fingerprint would override simulated UA.",
        "Weights": {
          "ClientSide": 0.2
        },
        "Transitions": [
          { "WhenRiskExceeds": 0.5, "WhenRiskBelow": 0.85, "GoTo": "default", "Description": "Uncertain zone - escalate to LLM" }
        ]
      },
      "learning": {
        "Description": "ASYNC LEARNING - full pipeline with all registered AI detectors, never blocks",
        "FastPath": ["FastPathReputation", "UserAgent", "Header", "Ip", "SecurityTool", "ProjectHoneypot", "CacheBehavior", "Behavioral", "AdvancedBehavioral", "ClientSide", "Inconsistency", "VersionAge", "ReputationBias"],
        "SlowPath": ["Heuristic"],
        "AiPath": ["Llm", "HeuristicLate"],
        "UseFastPath": false,
        "ForceSlowPath": true,
        "EscalateToAi": true,
        "AiEscalationThreshold": 0.0,
        "EarlyExitThreshold": 0.0,
        "ImmediateBlockThreshold": 1.0,
        "BypassTriggerConditions": true,
        "TimeoutSeconds": 10,
        "Tags": ["async", "learning", "full-pipeline", "never-blocks"]
      },
      "realfast": {
        "Description": "REAL FAST - Production mode that BLOCKS bots. Shows what users would actually see.",
        "FastPath": ["FastPathReputation", "UserAgent", "Header", "Ip", "SecurityTool", "ProjectHoneypot", "CacheBehavior", "Behavioral", "AdvancedBehavioral", "ClientSide", "Inconsistency", "VersionAge", "ReputationBias", "Heuristic"],
        "SlowPath": [],
        "AiPath": [],
        "UseFastPath": true,
        "ForceSlowPath": false,
        "EscalateToAi": false,
        "AiEscalationThreshold": 0.0,
        "EarlyExitThreshold": 0.85,
        "ImmediateBlockThreshold": 0.70,
        "DefaultBlockAction": "Challenge",
        "Tags": ["production", "blocking", "real-experience"]
      },
      "demo": {
        "Description": "DEMO - full pipeline sync for demonstration (Heuristic Wave 1, dual LLM Wave 2 in parallel)",
        "FastPath": ["FastPathReputation", "UserAgent", "Header", "Ip", "SecurityTool", "ProjectHoneypot", "CacheBehavior", "Behavioral", "AdvancedBehavioral", "ClientSide", "Inconsistency", "VersionAge", "ReputationBias"],
        "SlowPath": ["Heuristic"],
        "AiPath": ["Llm", "HeuristicLate"],
        "UseFastPath": false,
        "ForceSlowPath": true,
        "EscalateToAi": true,
        "AiEscalationThreshold": 0.0,
        "EarlyExitThreshold": 0.0,
        "ImmediateBlockThreshold": 1.0,
        "BypassTriggerConditions": true,
        "TimeoutSeconds": 20,
        "Tags": ["demo", "sync", "full-pipeline"]
      },
      "uaonly": {
        "Description": "UA ONLY - User-Agent based detection only (fastest, for UA string testing)",
        "FastPath": ["UserAgent", "SecurityTool", "VersionAge"],
        "SlowPath": [],
        "AiPath": [],
        "UseFastPath": true,
        "ForceSlowPath": false,
        "EscalateToAi": false,
        "EarlyExitThreshold": 0.0,
        "ImmediateBlockThreshold": 1.0,
        "Tags": ["ua-only", "fastest", "testing"]
      },
      "full-demo": {
        "Description": "FULL DEMO - ALL non-AI detectors enabled for comprehensive signature display",
        "FastPath": [
          "FastPathReputation", "HoneypotLink", "UserAgent", "Header", "Ip",
          "SecurityTool", "ProjectHoneypot", "CacheBehavior", "Behavioral",
          "AdvancedBehavioral", "ClientSide", "Inconsistency", "VersionAge",
          "ReputationBias", "Heuristic", "TlsFingerprint", "TcpIpFingerprint",
          "Http2Fingerprint", "MultiLayerCorrelation", "BehavioralWaveform",
          "ResponseBehavior"
        ],
        "SlowPath": [],
        "AiPath": [],
        "UseFastPath": true,
        "ForceSlowPath": false,
        "EscalateToAi": false,
        "AiEscalationThreshold": 0.0,
        "EarlyExitThreshold": 0.0,
        "ImmediateBlockThreshold": 1.0,
        "BypassTriggerConditions": true,
        "Tags": ["demo", "all-detectors", "no-ai", "full-fingerprinting"]
      }
    },
    "EnableUserAgentDetection": true,
    "EnableHeaderAnalysis": true,
    "EnableIpDetection": true,
    "EnableBehavioralAnalysis": true,
    "EnableLlmDetection": true,

    "ResponseHeaders": {
      "Enabled": true,
      "HeaderPrefix": "X-Bot-",
      "IncludePolicyName": true,
      "IncludeConfidence": true,
      "IncludeDetectors": true,
      "IncludeProcessingTime": true,
      "IncludeBotName": true,
      "IncludeFullJson": false
    },

    "YarpLearningMode": {
      "Enabled": true,
      "OutputPath": "./yarp-learning-data",
      "FileFormat": "jsonl",
      "LogToConsole": true,
      "MinConfidenceToLog": 0.0,
      "IncludeLlmDetector": false,
      "IncludeOnnxDetector": true,
      "SamplingRate": 1.0,
      "BufferSize": 10,
      "IncludeFullHttpContext": false,
      "IncludeRequestBody": false,
      "IncludeDetectorOutputs": true,
      "IncludeBlackboardSignals": true,
      "UseTimestampedFiles": true,
      "ExcludePaths": ["/health", "/healthz", "/ping", "/metrics"],
      "Rotation": {
        "MaxSizeBytes": 10485760,
        "MaxAgeHours": 1,
        "MaxFiles": 5
      }
    },

    "FastPath": {
      "Enabled": true,
      "MaxParallelDetectors": 50,
      "EnableWaveParallelism": true,
      "WaveTimeoutMs": 2000,
      "FastPathTimeoutMs": 5000,
      "EarlyExitThreshold": 0.99,
      "SkipSlowPathThreshold": 0.0,
      "SlowPathTriggerThreshold": 0.0,
      "AlwaysRunFullOnPaths": ["/bot-test"],
      "SlowPathDetectors": [
        { "Name": "Heuristic Detector", "Signal": "AiClassificationCompleted", "ExpectedLatencyMs": 1, "Wave": 1, "Category": "AI", "Weight": 2.0 },
        { "Name": "LLM Detector", "Signal": "LlmClassificationCompleted", "ExpectedLatencyMs": 500, "Wave": 2, "Category": "AI", "Weight": 2.5 },
        { "Name": "Inconsistency Detector", "Signal": "InconsistencyUpdated", "ExpectedLatencyMs": 2, "Wave": 1, "Category": "Inconsistency", "Weight": 1.5 },
        { "Name": "Version Age Detector", "Signal": "VersionAgeAnalyzed", "ExpectedLatencyMs": 1, "Wave": 1, "Category": "VersionAge", "Weight": 1.0 }
      ]
    },

    "VersionAge": {
      "Enabled": true,
      "CheckBrowserVersion": true,
      "CheckOsVersion": true,
      "MaxBrowserVersionAge": 10
    },

    "AiDetection": {
      "Provider": "Heuristic",
      "TimeoutMs": 15000,
      "MaxConcurrentRequests": 5,
      "Ollama": {
        "Endpoint": "http://localhost:11434",
        "Model": "gemma3:4b",
        "UseJsonMode": true
      },
      "Heuristic": {
        "Enabled": true,
        "LoadLearnedWeights": true,
        "EnableWeightLearning": true,
        "MinConfidenceForLearning": 0.8,
        "LearningRate": 0.01,
        "WeightReloadIntervalMinutes": 60
      }
    },

    "MaxRequestsPerMinute": 60,
    "CacheDurationSeconds": 0,
    "EnableBackgroundUpdates": true,
    "UpdateIntervalHours": 24,
    "StartupDelaySeconds": 2,
    "LogDetailedReasons": true,
    "LogPerformanceMetrics": true,

    "SecurityTools": {
      "Enabled": true,
      "BlockSecurityTools": true,
      "LogDetections": true,
      "CustomPatterns": [],
      "ExcludedPatterns": [],
      "EnabledCategories": [],
      "HoneypotRedirectUrl": null
    },

    "Holodeck": {
      "MockApiBaseUrl": "http://localhost:5000/api/mock",
      "Mode": "RealisticButUseless",
      "ContextSource": "Fingerprint",
      "MaxStudyRequests": 50,
      "MockApiTimeoutMs": 5000,
      "EnableHoneypotLinkDetection": true,
      "HoneypotPaths": [
        "/admin-secret",
        "/wp-login.php",
        "/.env",
        "/config.php",
        "/.git/config",
        "/phpmyadmin",
        "/backup.sql"
      ],
      "ReportToProjectHoneypot": false,
      "ProjectHoneypotAccessKey": null,
      "MinRiskToReport": 0.85,
      "MaxReportsPerHour": 100
    },

    "ProjectHoneypot": {
      "Enabled": true,
      "AccessKey": null,
      "HighThreatThreshold": 25,
      "MaxDaysAge": 90,
      "TimeoutMs": 1000,
      "CacheDurationSeconds": 1800,
      "SkipLocalIps": true,
      "TreatHarvestersAsMalicious": true,
      "TreatCommentSpammersAsMalicious": true,
      "TreatSuspiciousAsSuspicious": true
    },

    "Behavioral": {
      "ApiKeyHeader": "X-Api-Key",
      "ApiKeyRateLimit": 120,
      "UserIdHeader": "X-User-Id",
      "UserIdClaim": "sub",
      "UserRateLimit": 180,
      "EnableAnomalyDetection": true,
      "SpikeThresholdMultiplier": 5.0,
      "NewPathAnomalyThreshold": 0.8
    },

    "ClientSide": {
      "Enabled": true,
      "TokenSecret": "demo-secret-key-change-in-production",
      "TokenLifetimeSeconds": 300,
      "FingerprintCacheDurationSeconds": 1800,
      "CollectWebGL": true,
      "CollectCanvas": true,
      "MinIntegrityScore": 70,
      "HeadlessThreshold": 0.5
    },

    "DataSources": {
      "IsBot": {
        "Enabled": true,
        "Url": "https://raw.githubusercontent.com/omrilotan/isbot/main/src/patterns.json"
      },
      "Matomo": {
        "Enabled": false,
        "Url": "https://raw.githubusercontent.com/matomo-org/device-detector/master/regexes/bots.yml"
      },
      "CrawlerUserAgents": {
        "Enabled": false,
        "Url": "https://raw.githubusercontent.com/monperrus/crawler-user-agents/master/crawler-user-agents.json"
      },
      "AwsIpRanges": {
        "Enabled": true,
        "Url": "https://ip-ranges.amazonaws.com/ip-ranges.json"
      },
      "GcpIpRanges": {
        "Enabled": true,
        "Url": "https://www.gstatic.com/ipranges/cloud.json"
      },
      "AzureIpRanges": {
        "Enabled": false,
        "Url": ""
      },
      "CloudflareIpv4": {
        "Enabled": true,
        "Url": "https://www.cloudflare.com/ips-v4"
      },
      "CloudflareIpv6": {
        "Enabled": true,
        "Url": "https://www.cloudflare.com/ips-v6"
      },
      "ScannerUserAgents": {
        "Enabled": true,
        "Url": "https://raw.githubusercontent.com/digininja/scanner_user_agents/main/list.json"
      },
      "CoreRuleSetScanners": {
        "Enabled": true,
        "Url": "https://raw.githubusercontent.com/coreruleset/coreruleset/main/rules/scanners-user-agents.data"
      }
    }
  }
}
